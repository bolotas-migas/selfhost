name: openclaw

services:
  openclaw-gateway:
    container_name: openclaw_gateway
    image: alpine/openclaw:main
    command: ["node", "dist/index.js", "gateway", "--port", "18789"]
    env_file:
      - env
    volumes:
      - openclaw-home:/home/node
      - ./openclaw.json:/home/node/.openclaw/openclaw.json:ro
    ports:
      - '192.168.1.15:18789:18789'
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 1536m
          pids: 128
        reservations:
          cpus: '0.25'
          memory: 256m
    healthcheck:
      test: ["CMD", "node", "-e", "fetch('http://127.0.0.1:18789/').then(r => process.exit(r.ok ? 0 : 1)).catch(() => process.exit(1))"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 30s

  openclaw-cli:
    container_name: openclaw_cli
    image: alpine/openclaw:main
    entrypoint: ["node", "dist/index.js"]
    env_file:
      - env
    volumes:
      - openclaw-home:/home/node
      - ./openclaw.json:/home/node/.openclaw/openclaw.json:ro
    profiles:
      - cli

volumes:
  openclaw-home:
